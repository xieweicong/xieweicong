<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Docker on xieweicong&#39;s blog</title>
    <link>http://localhost:1313/tags/docker/</link>
    <description>Recent content in Docker on xieweicong&#39;s blog</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 16 Dec 2021 17:42:17 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/docker/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Docker从布置到上线</title>
      <link>http://localhost:1313/code/docker%E4%BB%8E%E5%B8%83%E7%BD%AE%E5%88%B0%E4%B8%8A%E7%BA%BF/</link>
      <pubDate>Thu, 16 Dec 2021 17:42:17 +0800</pubDate>
      <guid>http://localhost:1313/code/docker%E4%BB%8E%E5%B8%83%E7%BD%AE%E5%88%B0%E4%B8%8A%E7%BA%BF/</guid>
      <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;&#xA;&lt;p&gt;docker技术真的非常好用和方便，但看了很多文章很杂乱，所以整理一个从安装打包到上线的全过程&lt;/p&gt;&#xA;&lt;h2 id=&#34;安装doker&#34;&gt;安装doker&lt;/h2&gt;&#xA;&lt;p&gt;macOS最好直接官网下载GUI的版本安装&lt;/p&gt;&#xA;&lt;p&gt;在linex远程服务器上&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL &amp;lt;https://get.docker.com&amp;gt; | bash -s docker --mirror Aliyun&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;修改允许的hosts&#34;&gt;修改允许的hosts&lt;/h2&gt;&#xA;&lt;p&gt;在django中需要填入vps的地址或域名&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/008i3skNgy1gxftfjahojj316w0oan1z.jpg&#34; alt=&#34;截屏2021-12-06 上午12.00.39&#34;&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;文件准备&#34;&gt;文件准备&lt;/h2&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/008i3skNgy1gxftfsckyij30gy0ak74w.jpg&#34; alt=&#34;20190408113307863&#34;&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;pipconf&#34;&gt;&lt;strong&gt;pip.conf&lt;/strong&gt;&lt;/h3&gt;&#xA;&lt;p&gt;这个是pip的配置文件，制作完成之后，将这个文件复制到虚拟机对应的pip根目录下，即可完成替换。主要功能是换成阿里云的镜像。在境外的话不需要这个。&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[global]&#xA;index-url = &amp;lt;http://mirrors.aliyun.com/pypi/simple/&amp;gt;&#xA;[install]&#xA;trusted-host=mirrors.aliyun.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;requirementstxt&#34;&gt;&lt;strong&gt;requirements.txt&lt;/strong&gt;&lt;/h3&gt;&#xA;&lt;p&gt;用下列代码快速导出本机或虚拟环境的所有依赖&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip freeze &amp;gt; requirements.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;dockerfile&#34;&gt;&lt;strong&gt;Dockerfile&lt;/strong&gt;&lt;/h3&gt;&#xA;&lt;p&gt;docker在创建时将会使用这个文件进行构建。比较特殊的是这个文件没有后缀名，所以像Mac就不能直接创建，使用&lt;code&gt;touch&lt;/code&gt;命令执行生成。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;touch Dockerfile&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim Dockerfile&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FROM python:3.9&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN mkdir -p /usr/src/app&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;WORKDIR /usr/src/app&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY pip.conf /root/.pip/pip.conf&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY requirements.txt /usr/src/app/&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN pip install -r /usr/src/app/requirements.txt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN rm -rf /usr/src/app&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY . /usr/src/app&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CMD &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;python&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;./manage.py&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;runserver&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:8080&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;CMD &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;python3&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-m&amp;#34;&lt;/span&gt; , &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;flask&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;run&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;--host=0.0.0.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;##flask用这条，默认到5000端口&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;&#xA;&lt;li&gt;以官方库python:3.9为基础进行制作，实际是一个装有python3.9的Linux&lt;/li&gt;&#xA;&lt;li&gt;运行命令创建新文件夹 /usr/src/app&lt;/li&gt;&#xA;&lt;li&gt;确定工作路径&lt;/li&gt;&#xA;&lt;li&gt;将本地的pip.conf复制到pip的根中进行替换&lt;/li&gt;&#xA;&lt;li&gt;将requirements.txt复制到指定目录下&lt;/li&gt;&#xA;&lt;li&gt;运行命令按照requirements.txt的内容进行pip安装&lt;/li&gt;&#xA;&lt;li&gt;运行命令删除这个文件夹中的所有内容，-rf是递归强制删除&lt;/li&gt;&#xA;&lt;li&gt;将整个项目复制到这个文件夹中&lt;/li&gt;&#xA;&lt;li&gt;执行命令运行docker时，内部Django项目的运行命令，开放8080端口&lt;/li&gt;&#xA;&lt;li&gt;flask用这条，默认到5000端口&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;制作镜像image&#34;&gt;&lt;strong&gt;制作镜像image&lt;/strong&gt;&lt;/h2&gt;&#xA;&lt;p&gt;这里就是执行这个Dockerfile文件了，随便给镜像取个名字&lt;code&gt;my-django-app&lt;/code&gt;，后面的&lt;code&gt;.&lt;/code&gt;表示当前文件夹，会自动寻找Dockerfile文件并执行。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
